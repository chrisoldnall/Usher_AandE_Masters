library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
View(Covid_monthlyae_glmdemographicsCoviddate_all)
View(Covid_monthlyae_glmdemographicsage)
View(Covid_monthlyae_glmdemographicssex)
View(Covid_monthlyae_glmdemographicsdeprivation)
View(Covid_monthlyae_glmdemographicsdepttype)
View(Covid_monthlyae_glmdemographicsHB)
View(Covid_monthlyae_glmdemographicstotal)
View(Covid_monthlyae_glmwhenday)
View(Covid_monthlyae_glmwhenhour)
View(Covid_monthlyae_glmwhenmonth)
#Combining all the proportions data into one table using merge
#Covid_monthlyae_glmdemographicsage
#Covid_monthlyae_glmdemographicssex
#Covid_monthlyae_glmdemographicsdeprivation
#Covid_monthlyae_glmdemographicsdepttype
#Covid_monthlyae_glmdemographicsHB
#Covid_monthlyae_glmdemographicsCoviddate_all
#Covid_monthlyae_glmwhenday
#Covid_monthlyae_glmwhenhour
#Covid_monthlyae_glmwhenmonth
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmdemographicsage, Covid_monthlyae_glmdemographicssex, by=c("date"))
View(Covid_monthlyae_glmprop)
View(Covid_monthlyae_glmdemographicsCoviddate_all)
#Combining all the proportions data into one table using merge
#Covid_monthlyae_glmdemographicsage
#Covid_monthlyae_glmdemographicssex
#Covid_monthlyae_glmdemographicsdeprivation
#Covid_monthlyae_glmdemographicsdepttype
#Covid_monthlyae_glmdemographicsHB
#Covid_monthlyae_glmdemographicsCoviddate_all
#Covid_monthlyae_glmwhenday
#Covid_monthlyae_glmwhenhour
#Covid_monthlyae_glmwhenmonth
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsage, by=c("date"))
View(Covid_monthlyae_glmprop)
#Combining all the proportions data into one table using merge
#Covid_monthlyae_glmdemographicsage
#Covid_monthlyae_glmdemographicssex
#Covid_monthlyae_glmdemographicsdeprivation
#Covid_monthlyae_glmdemographicsdepttype
#Covid_monthlyae_glmdemographicsHB
#Covid_monthlyae_glmdemographicsCoviddate_all
#Covid_monthlyae_glmwhenday
#Covid_monthlyae_glmwhenhour
#Covid_monthlyae_glmwhenmonth
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicssex, by=c("date"))
View(Covid_monthlyae_glmprop)
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsage, by=c("date"))
#Combining all the proportions data into one table using merge
#Covid_monthlyae_glmdemographicsage
#Covid_monthlyae_glmdemographicssex
#Covid_monthlyae_glmdemographicsdeprivation
#Covid_monthlyae_glmdemographicsdepttype
#Covid_monthlyae_glmdemographicsHB
#Covid_monthlyae_glmdemographicsCoviddate_all
#Covid_monthlyae_glmwhenday
#Covid_monthlyae_glmwhenhour
#Covid_monthlyae_glmwhenmonth
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsdepttype, by=c("date"))
View(Covid_monthlyae_glmprop)
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicssex, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsage, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsdeprivation, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenday, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenmonth, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenhour, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsHB, by=c("date"))
View(Covid_monthlyae_glmprop)
View(ae_monthly_total)
#To limit the GLM data to Jan 2018 to Dec 2022.
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
filter(between(date, as.Date("2018-01-01"), as.Date("2022-12-31")))
View(Covid_monthlyae_glmprop)
View(Covid_monthlyae_glmdemographicstotal)
Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(sample=NumberOfAttendances)) +
stat_qq() +
stat_qq_line(color=2)
#Q_Q plot
QQplotglmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(sample=NumberOfAttendances)) +
stat_qq() +
stat_qq_line(color=2)
save_plot("Output/glmdemographicstotal.svg", fig = glmdemographicstotal, width = 14, height = 12)
QQplotglmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(sample=NumberOfAttendances)) +
stat_qq() +
stat_qq_line(color=2)
save_plot("Output/QQplotglmdemographicstotal.svg", fig = QQplotglmdemographicstotal, width = 14, height = 12)
Covid_monthlyae_glmdemographicstotal %>%
pull(NumberOfAttendances) %>%
ks.test(., "pnorm", mean=mean(.), sd=sd(.))
Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(x=NumberOfAttendances))+
geom_histogram()
#Histogram of total number of attendances - distribution skewed to the right, not normal
HistogramCovid_monthlyae_glmdemographicstotal < - Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(x=NumberOfAttendances))+
geom_histogram()
HistogramCovid_monthlyae_glmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(x=NumberOfAttendances))+
geom_histogram()
save_plot("Output/HistogramCovid_monthlyae_glmdemographicstotal.svg", fig = HistogramCovid_monthlyae_glmdemographicstotal, width = 14, height = 12)
View(glm_sexage)
View(Covid_monthlyae_glmprop)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
View(Covid_monthlyae_glmdemographicstotal)
View(Covid_monthlyae_glmprop)
View(sexagesimddayhourdepttypeHBupdatedmonthTime_proportions)
View(Covid_monthlyae_glmprop)
#To include Time into the data frame
#example given: df$Time <- as.numeric(df$Date - min(df$Date)) + 1
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
mutate(Time = as.numeric(Covid_monthlyae_glmprop$date - min(Covid_monthlyae_glmprop$date)) + 1)
View(Covid_monthlyae_glmprop)
#install.packages("tidyverse")
#install.packages("here")
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("sf")
#install.packages("sjPlot")
install.packages("pscl")
library(pscl)
View(ScotUpdatespopulation2018to2023glmplot)
View(sexagesimddayhourdepttypeHBmonth_proportions)
View(sexagesimddayhourdepttypeHBupdatedmonth_proportionsglmplot)
View(Covid_HBpopulation_estimate)
#Loading population estimate (only till 2022) csv file
Scotpopulation2018to2022Covidglmplot <- read_csv(here("Rawdata", "20240809Popestimate_HB2019_1981to2022.csv"))
View(Scotpopulation2018to2022Covidglmplot)
#Filtering out total Scottish estimates (HB S92000003) for each year, leaving just individual HBs in the list
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(!HB%in%"S92000003"|Sex=="All")
View(Scotpopulation2018to2022Covidglmplot)
#Loading population estimate (only till 2022) csv file
Scotpopulation2018to2022Covidglmplot <- read_csv(here("Rawdata", "20240809Popestimate_HB2019_1981to2022.csv"))
#Filtering out total Scottish estimates (HB S92000003) for each year, leaving just individual HBs in the list
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(!HB%in%"S92000003")
View(Scotpopulation2018to2022Covidglmplot)
#Excluding population by sex, only the totals for each HB each year
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(Sex=="All")
View(Scotpopulation2018to2022Covidglmplot)
#Only getting the total population estimates for 2018-2022
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
group_by(Year) %>%
summarise(AllAges=sum(AllAges)) %>%
filter(Year=="2018"|Year=="2019"|Year=="2020"|Year=="2021"|Year=="2022") %>%
select(Year, AllAges)
View(Scotpopulation2018to2022Covidglmplot)
View(ScotUpdatespopulation2018to2023glmplot)
View(sexagesimddayhourdepttypeHB_proportionsglmplot)
View(Covid_monthlyae_glmprop)
View(Scotpopulation2018to2022Covidglmplot)
View(Scotpopulation2018to2022Covidglmplot)
View(ScottishMapHB4Hwaiting2012)
View(Covid_monthlyae_glmprop)
#Using Coviddate1 as reference
Covidglm_Coviddate <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
View(Covid_monthlyae_glmprop)
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
rename("Covidadate2 = "Coviddate2)
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
rename("Covidadate2" = "Coviddate2")
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
rename("Coviddate2" = "Covidadate2")
View(Covid_monthlyae_glmprop)
#Populating each batch of date ranges individually
Covid_monthlyae_glmdemographicsCoviddate_a <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2018-01-01'), as.Date('2020-03-31'))) %>%
mutate(Coviddate1 = 0,
Coviddate2 = 0,
Coviddate3 = 0,
Coviddate4 = 1)
Covid_monthlyae_glmdemographicsCoviddate_b <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2020-04-01'), as.Date('2020-05-31'))) %>%
mutate(Coviddate1 = 1,
Coviddate2 = 0,
Coviddate3 = 0,
Coviddate4 = 0)
Covid_monthlyae_glmdemographicsCoviddate_c <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2020-06-01'), as.Date('2020-09-30'))) %>%
mutate(Coviddate1 = 0,
Coviddate2 = 0,
Coviddate3 = 1,
Coviddate4 = 0)
Covid_monthlyae_glmdemographicsCoviddate_d <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2020-10-01'), as.Date('2020-12-31'))) %>%
mutate(Coviddate1 = 0,
Coviddate2 = 1,
Coviddate3 = 0,
Coviddate4 = 0)
Covid_monthlyae_glmdemographicsCoviddate_e <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2021-01-01'), as.Date('2021-04-30'))) %>%
mutate(Coviddate1 = 1,
Coviddate2 = 0,
Coviddate3 = 0,
Coviddate4 = 0)
Covid_monthlyae_glmdemographicsCoviddate_f <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2021-05-01'), as.Date('2021-07-31'))) %>%
mutate(Coviddate1 = 0,
Coviddate2 = 0,
Coviddate3 = 1,
Coviddate4 = 0)
Covid_monthlyae_glmdemographicsCoviddate_g <- Covid_monthlyae_glmdemographicsCoviddate %>%
filter(between(date, as.Date('2021-08-01'), as.Date('2024-06-30'))) %>%
mutate(Coviddate1 = 0,
Coviddate2 = 0,
Coviddate3 = 0,
Coviddate4 = 1)
#Combining all the batches of date ranges for Covid into one dataframe
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_a, Covid_monthlyae_glmdemographicsCoviddate_b)
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsCoviddate_c)
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsCoviddate_d)
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsCoviddate_e)
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsCoviddate_f)
Covid_monthlyae_glmdemographicsCoviddate_all <- rbind(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsCoviddate_g)
#Using Coviddate1 as reference
Covidglm_Coviddate <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddate)
#Using UnknownSex as reference
Covidglm_Coviddatesex <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddatesex)
#Using UnkknownAge as reference
Covidglm_Coviddatesexage <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddatesexage)
#Using UnknownSIMD as reference
Covidglm_CoviddatesexageSIMD <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMD)
#Using Monday as reference
Covidglm_CoviddatesexageSIMDday <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDday)
#Using MIU/Other as reference
Covidglm_CoviddatesexageSIMDdaytype <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytype)
#Using Onetotwoam as reference
Covidglm_CoviddatesexageSIMDdaytypehour <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehour)
#Using NHSAyshireandArran as reference
Covidglm_CoviddatesexageSIMDdaytypehourHB <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHB)
##Using month
#Using January as reference
Covidglm_CoviddatesexageSIMDdaytypehourHBmonth <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Feb + March + April + May + June + July + August + Sept + Oct + Nov + Dec,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
##Using time
Covidglm_CoviddatesexageSIMDdaytypehourHBTime <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + Seventyfiveplus + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
summary(Covidglm_Coviddate)
summary(Covidglm_Coviddatesex)
#Using UnkknownAge and Seventyfiveplus as reference
Covidglm_Coviddatesexage <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddatesexage)
#Using UnknownSIMD as reference
Covidglm_CoviddatesexageSIMD <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMD)
#Using Monday as reference
Covidglm_CoviddatesexageSIMDday <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDday)
#Using MIU/Other as reference
Covidglm_CoviddatesexageSIMDdaytype <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytype)
#Using Onetotwoam as reference
Covidglm_CoviddatesexageSIMDdaytypehour <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehour)
#Using NHSAyshireandArran as reference
Covidglm_CoviddatesexageSIMDdaytypehourHB <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHB)
##Using month
#Using January as reference
Covidglm_CoviddatesexageSIMDdaytypehourHBmonth <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Feb + March + April + May + June + July + August + Sept + Oct + Nov + Dec,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
##Using time
Covidglm_CoviddatesexageSIMDdaytypehourHBTime <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
#To calculate the AIC
glm_Coviddate_aic <- AIC(Covidglm_Coviddate)
glm_Coviddate_aic
glm_Coviddatesex_aic <- AIC(Covidglm_Coviddatesex)
glm_Coviddatesex_aic
glm_Coviddatesexage_aic <- AIC(Covidglm_Coviddatesexage)
glm_Coviddatesexage_aic
glm_CoviddatesexageSIMD_aic <- AIC(Covidglm_CoviddatesexageSIMD)
glm_CoviddatesexageSIMD_aic
glm_CoviddatesexageSIMDday_aic <- AIC(Covidglm_CoviddatesexageSIMDday)
glm_CoviddatesexageSIMDday_aic
glm_CoviddatesexageSIMDdaytype_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytype)
glm_CoviddatesexageSIMDdaytype_aic
glm_CoviddatesexageSIMDdaytypehour_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehour)
glm_CoviddatesexageSIMDdaytypehour_aic
glm_CoviddatesexageSIMDdaytypehourHB_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHB)
glm_CoviddatesexageSIMDdaytypehourHB_aic
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic
glm_CoviddatesexageSIMDdaytypehourHBTime_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
glm_CoviddatesexageSIMDdaytypehourHBTime_aic
#McFadden's R-squared
#with reference to https://www.statology.org/glm-r-squared/
#method one using the package pscl
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)['McFadden']
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)['McFadden']
glm_Coviddate_predictions <-predict(Covidglm_Coviddate, type = "response")
summary(glm_Coviddate_predictions)
glm_Coviddatesex_predictions <-predict(Covidglm_Coviddatesex, type = "response")
summary(glm_Coviddatesex_predictions)
glm_Coviddatesexage_predictions <-predict(Covidglm_Coviddatesexage, type = "response")
summary(glm_Coviddatesexage_predictions)
glm_CoviddatesexageSIMD_predictions <-predict(Covidglm_CoviddatesexageSIMD, type = "response")
summary(glm_CoviddatesexageSIMD_predictions)
glm_CoviddatesexageSIMDday_predictions <-predict(Covidglm_CoviddatesexageSIMDday, type = "response")
summary(glm_CoviddatesexageSIMDday_predictions)
glm_CoviddatesexageSIMDdaytype_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytype, type = "response")
summary(glm_CoviddatesexageSIMDdaytype_predictions)
glm_CoviddatesexageSIMDdaytypehour_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytypehour, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehour_predictions)
glm_CoviddatesexageSIMDdaytypehourHB_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytypehourHB, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHB_predictions)
glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions <- predict(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions)
glm_CoviddatesexageSIMDdaytypehourHBTime_predictions <- predict(Covidglm_CoviddatesexageSIMDdaytypehourHBTime, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHBTime_predictions)
#Loading population estimate (only till 2022) csv file
Scotpopulation2018to2022Covidglmplot <- read_csv(here("Rawdata", "20240809Popestimate_HB2019_1981to2022.csv"))
#Filtering out total Scottish estimates (HB S92000003) for each year, leaving just individual HBs in the list
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(!HB%in%"S92000003")
#Excluding population by sex, only the totals for each HB each year
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(Sex=="All")
#Only getting the total population estimates for 2018-2022
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
group_by(Year) %>%
summarise(AllAges=sum(AllAges)) %>%
filter(Year=="2018"|Year=="2019"|Year=="2020"|Year=="2021"|Year=="2022") %>%
select(Year, AllAges)
#Selecting only the columns needed for glm plot and adding a column for year to join with the population data
Covid_monthlyae_glmpropglmplot <- Covid_monthlyae_glmprop %>%
select(date, NumberOfAttendances)
Covid_monthlyae_glmpropglmplot$Year <- format(as.Date(Covid_monthlyae_glmprop$date), format="%Y/%m/%d","%Y")
View(Covid_monthlyae_glmpropglmplot)
str(Covid_monthlyae_glmpropglmplot )
Covid_monthlyae_glmpropglmplot$Year <- format(as.Date(Covid_monthlyae_glmprop$date), format=("%Y/%m/%d","%Y"))
#ERROR MESSAGE HERE
Covid_monthlyae_glmpropglmplot$Year <- format(as.Date(Covid_monthlyae_glmprop$date), format="%Y/%m/%d","%Y")
#ERROR MESSAGE HERE
Covid_monthlyae_glmpropglmplot$Year <- format(Covid_monthlyae_glmprop$date, format="%Y/%m/%d","%Y")
View(Covid_monthlyae_glmpropglmplot)
Covid_monthlyae_glmpropglmplot$Year <- as.numeric(format(Covid_monthlyae_glmprop$date,'%Y'))
View(Covid_monthlyae_glmpropglmplot)
#combining population data with attendance data to create the glm plot
Covid_monthlyae_glmpropglmplot <-
merge(Scotpopulation2018to2022Covidglmplot, Covid_monthlyae_glmpropglmplot, by=c("Year"))
View(Covid_monthlyae_glmpropglmplot)
#combining the glm predictions for glm_xxx_prediction data with actual
Covid_monthlyae_glmpropglmplot <- Covid_monthlyae_glmpropglmplot %>%
mutate("glmCoviddateprediction" = glm_Coviddate_predictions/AllAges,
"glmCoviddatesexprediction" = glm_Coviddatesex_predictions/AllAges,
"glmCoviddatesexageprediction" = glm_Coviddatesexage_predictions/AllAges,
"glmCoviddatesexageSIMDprediction" = glm_CoviddatesexageSIMD_predictions/AllAges,
"glmCoviddatesexageSIMDdayprediction" = glm_CoviddatesexageSIMDday_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypeprediction" = glm_CoviddatesexageSIMDdaytype_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourprediction" = glm_CoviddatesexageSIMDdaytypehour_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBprediction" = glm_CoviddatesexageSIMDdaytypehourHB_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBmonthprediction" = glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBTimeprediction" = glm_CoviddatesexageSIMDdaytypehourHBTime_predictions/AllAges,
"rates" = NumberOfAttendances/AllAges)
glmCoviddateprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddateprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddateprediction), color = "yellow4")
glmCoviddateprediction
save_plot("Output/glmCoviddateprediction.svg", fig = glmCoviddateprediction, width = 5, height = 5)
glmCoviddatesexprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddateprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexprediction), color = "red")
glmCoviddatesexprediction
save_plot("Output/glmCoviddatesexprediction.svg", fig = glmCoviddatesexprediction, width = 5, height = 5)
glmCoviddatesexageprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageprediction), color = "blue")
glmCoviddatesexageprediction
save_plot("Output/glmCoviddatesexageprediction.svg", fig = glmCoviddatesexageprediction, width = 5, height = 5)
glmCoviddatesexageSIMDprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDprediction), color = "green")
save_plot("Output/glmCoviddatesexageSIMDprediction.svg", fig = glmCoviddatesexageSIMDprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdayprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdayprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdayprediction), color = "yellow")
save_plot("Output/glmCoviddatesexageSIMDdayprediction.svg", fig = glmCoviddatesexageSIMDdayprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypeprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypeprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypeprediction), color = "orange")
save_plot("Output/glmCoviddatesexageSIMDdaytypeprediction.svg", fig = glmCoviddatesexageSIMDdaytypeprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourprediction), color = "purple")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBprediction), color = "brown")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBmonthprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBmonthprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBmonthprediction), color = "salmon")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBmonthprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBmonthprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBTimeprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBTimeprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBTimeprediction), color = "magenta")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBTimeprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBTimeprediction, width = 5, height = 5)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic
glm_CoviddatesexageSIMDdaytypehourHBTime_aic
#McFadden's R-squared
#with reference to https://www.statology.org/glm-r-squared/
#method one using the package pscl
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)['McFadden']
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)['McFadden']
