annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown
2 Tightening
3 Easing
4 Removed"),nudge_x=2019, nudge_y=60100))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n
2 Tightening \n
3 Easing \n
4 Removed"),nudge_x=2019, nudge_y=60100, check_overlap = T))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n
2 Tightening \n
3 Easing \n
4 Removed"),x=2019, y=60100))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n
2 Tightening \n
3 Easing \n
4 Removed"),x=as.Date("2019-01-01"), y=60100))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n
2 Tightening \n
3 Easing \n
4 Removed"),x=as.Date("2019-01-01"), y=75000))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n 2 Tightening \n 3 Easing \n 4 Removed"),x=as.Date("2019-01-01"), y=100000))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n 2 Tightening \n 3 Easing \n 4 Removed"),x=as.Date("2018-11-01"), y=90000))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
Covid_aeScotlandactivity_encodingtimeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n 2 Tightening \n 3 Easing \n 4 Removed"),x=as.Date("2018-11-01"), y=90000))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_encodingtimeline2018to2022.svg", fig=Covid_aeScotlandactivity_timeline2018to2022, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-23"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) +
geom_rect(aes(xmin = as.Date("2020-03-23"), xmax = as.Date("2020-05-29"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #UKlockdown
geom_rect(aes(xmin = as.Date("2020-05-29"), xmax = as.Date("2020-06-19"), ymin=-Inf, ymax=Inf), fill="#FF0099", alpha=.01) + #Phase 1
geom_rect(aes(xmin = as.Date("2020-06-19"), xmax = as.Date("2020-07-10"), ymin=-Inf, ymax=Inf), fill="#CC33CC", alpha=.01) + #Phase2
geom_rect(aes(xmin = as.Date("2020-07-10"), xmax = as.Date("2020-09-23"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Phase3
geom_rect(aes(xmin = as.Date("2020-09-23"), xmax = as.Date("2021-01-05"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Scottish restrictions
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #Scottish mainland lockdown
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Stay home to stay local
geom_rect(aes(xmin = as.Date("2021-04-02"), xmax = as.Date("2021-05-17"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Level 3
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-06-05"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #Level 2
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-07-19"), ymin=-Inf, ymax=Inf), fill="#9999FF", alpha=.01) + #Most mainland level 1
geom_rect(aes(xmin = as.Date("2021-07-19"), xmax = as.Date("2021-08-09"), ymin=-Inf, ymax=Inf), fill="#66CCFF", alpha=.01) + #Level 0
geom_rect(aes(xmin = as.Date("2021-08-09"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #Beyond level 0
#theme_classic()+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022.svg", fig=Covid_aeScotlandactivity_timeline2018to2022, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-23"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) +
geom_rect(aes(xmin = as.Date("2020-03-23"), xmax = as.Date("2020-05-29"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #UKlockdown
geom_rect(aes(xmin = as.Date("2020-05-29"), xmax = as.Date("2020-06-19"), ymin=-Inf, ymax=Inf), fill="#FF0099", alpha=.01) + #Phase 1
geom_rect(aes(xmin = as.Date("2020-06-19"), xmax = as.Date("2020-07-10"), ymin=-Inf, ymax=Inf), fill="#CC33CC", alpha=.01) + #Phase2
geom_rect(aes(xmin = as.Date("2020-07-10"), xmax = as.Date("2020-09-23"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Phase3
geom_rect(aes(xmin = as.Date("2020-09-23"), xmax = as.Date("2021-01-05"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Scottish restrictions
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #Scottish mainland lockdown
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Stay home to stay local
geom_rect(aes(xmin = as.Date("2021-04-02"), xmax = as.Date("2021-05-17"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Level 3
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-06-05"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #Level 2
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-07-19"), ymin=-Inf, ymax=Inf), fill="#9999FF", alpha=.01) + #Most mainland level 1
geom_rect(aes(xmin = as.Date("2021-07-19"), xmax = as.Date("2021-08-09"), ymin=-Inf, ymax=Inf), fill="#66CCFF", alpha=.01) + #Level 0
geom_rect(aes(xmin = as.Date("2021-08-09"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #Beyond level 0
#theme_classic()+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022.svg", fig=Covid_aeScotlandactivity_timeline2018to2022, width=14, height=12)
Covid_aeScotlandactivity_encodingtimeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_label(aes(label= ("1 Lockdown \n 2 Tightening \n 3 Easing \n 4 Removed"),x=as.Date("2018-11-01"), y=90000))+
#legend("bottomleft", inset=0.2, title="Restrictions", c("1 Lockdown", "2 Tightening", "3 Easing", "4 Removed"), col=c("#FF0033", "#FF00CC", "#9966FF", "#00FFFF", lty=1:2, cex=0.8)) +
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2019-02-28"), color="black", y=60100, size=3, label="4")+
geom_rect(aes(xmin = as.Date("2020-04-01"), xmax = as.Date("2020-05-31"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2020-04-30"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2020-06-01"), xmax = as.Date("2020-09-30"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2020-07-30"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2020-10-01"), xmax = as.Date("2020-12-31"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #2
annotate(geom="text", x=as.Date("2020-11-15"), color="black", y=60100, size=3, label="2")+
geom_rect(aes(xmin = as.Date("2021-01-01"), xmax = as.Date("2021-04-30"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #1
annotate(geom="text", x=as.Date("2021-03-01"), color="black", y=60100, size=3, label="1")+
geom_rect(aes(xmin = as.Date("2021-05-01"), xmax = as.Date("2021-07-31"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #3
annotate(geom="text", x=as.Date("2021-06-15"), color="black", y=60100, size=3, label="3")+
geom_rect(aes(xmin = as.Date("2021-08-01"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #4
annotate(geom="text", x=as.Date("2022-04-01"), color="black", y=60100, size=3, label="4")+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_encodingtimeline2018to2022.svg", fig=Covid_aeScotlandactivity_encodingtimeline2018to2022, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-23"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) +
geom_rect(aes(xmin = as.Date("2020-03-23"), xmax = as.Date("2020-05-29"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #UKlockdown
geom_rect(aes(xmin = as.Date("2020-05-29"), xmax = as.Date("2020-06-19"), ymin=-Inf, ymax=Inf), fill="#FF0099", alpha=.01) + #Phase 1
geom_rect(aes(xmin = as.Date("2020-06-19"), xmax = as.Date("2020-07-10"), ymin=-Inf, ymax=Inf), fill="#CC33CC", alpha=.01) + #Phase2
geom_rect(aes(xmin = as.Date("2020-07-10"), xmax = as.Date("2020-09-23"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Phase3
geom_rect(aes(xmin = as.Date("2020-09-23"), xmax = as.Date("2021-01-05"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Scottish restrictions
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #Scottish mainland lockdown
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Stay home to stay local
geom_rect(aes(xmin = as.Date("2021-04-02"), xmax = as.Date("2021-05-17"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Level 3
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-06-05"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #Level 2
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-07-19"), ymin=-Inf, ymax=Inf), fill="#9999FF", alpha=.01) + #Most mainland level 1
geom_rect(aes(xmin = as.Date("2021-07-19"), xmax = as.Date("2021-08-09"), ymin=-Inf, ymax=Inf), fill="#66CCFF", alpha=.01) + #Level 0
geom_rect(aes(xmin = as.Date("2021-08-09"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #Beyond level 0
#theme_classic()+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022.svg", fig=Covid_aeScotlandactivity_timeline2018to2022, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022 + coord_flip()
Covid_aeScotlandactivity_timeline2018to2022flip <- Covid_aeScotlandactivity_timeline2018to2022 + coord_flip()
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022flip.svg", fig=Covid_aeScotlandactivity_timeline2018to2022flip, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022<- ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-23"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) +
geom_rect(aes(xmin = as.Date("2020-03-23"), xmax = as.Date("2020-05-29"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #UKlockdown
geom_rect(aes(xmin = as.Date("2020-05-29"), xmax = as.Date("2020-06-19"), ymin=-Inf, ymax=Inf), fill="#FF0099", alpha=.01) + #Phase 1
geom_rect(aes(xmin = as.Date("2020-06-19"), xmax = as.Date("2020-07-10"), ymin=-Inf, ymax=Inf), fill="#CC33CC", alpha=.01) + #Phase2
geom_rect(aes(xmin = as.Date("2020-07-10"), xmax = as.Date("2020-09-23"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Phase3
geom_rect(aes(xmin = as.Date("2020-09-23"), xmax = as.Date("2021-01-05"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Scottish restrictions
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #Scottish mainland lockdown
geom_rect(aes(xmin = as.Date("2021-04-02"), xmax = as.Date("2021-04-26"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Stay home to stay local
geom_rect(aes(xmin = as.Date("2021-04-26"), xmax = as.Date("2021-05-17"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Level 3
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-06-05"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #Level 2
geom_rect(aes(xmin = as.Date("2021-06-05"), xmax = as.Date("2021-07-19"), ymin=-Inf, ymax=Inf), fill="#9999FF", alpha=.01) + #Most mainland level 1
geom_rect(aes(xmin = as.Date("2021-07-19"), xmax = as.Date("2021-08-09"), ymin=-Inf, ymax=Inf), fill="#66CCFF", alpha=.01) + #Level 0
geom_rect(aes(xmin = as.Date("2021-08-09"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #Beyond level 0
#theme_classic()+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022.svg", fig=Covid_aeScotlandactivity_timeline2018to2022, width=14, height=12)
ggplot(data=Covid_monthlyae_activity_timeline, aes(x=date, y=NumberOfAttendancesAll))+
geom_point()+
geom_line(size=1,colour="black")+
geom_rect(aes(xmin = as.Date("2018-01-01"), xmax = as.Date("2020-03-23"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) +
geom_rect(aes(xmin = as.Date("2020-03-23"), xmax = as.Date("2020-05-29"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #UKlockdown
geom_rect(aes(xmin = as.Date("2020-05-29"), xmax = as.Date("2020-06-19"), ymin=-Inf, ymax=Inf), fill="#FF0099", alpha=.01) + #Phase 1
geom_rect(aes(xmin = as.Date("2020-06-19"), xmax = as.Date("2020-07-10"), ymin=-Inf, ymax=Inf), fill="#CC33CC", alpha=.01) + #Phase2
geom_rect(aes(xmin = as.Date("2020-07-10"), xmax = as.Date("2020-09-23"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Phase3
geom_rect(aes(xmin = as.Date("2020-09-23"), xmax = as.Date("2021-01-05"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Scottish restrictions
geom_rect(aes(xmin = as.Date("2021-01-05"), xmax = as.Date("2021-04-02"), ymin=-Inf, ymax=Inf), fill="#FF0033", alpha=.01) + #Scottish mainland lockdown
geom_rect(aes(xmin = as.Date("2021-04-02"), xmax = as.Date("2021-04-26"), ymin=-Inf, ymax=Inf), fill="#FF00CC", alpha=.01) + #Stay home to stay local
geom_rect(aes(xmin = as.Date("2021-04-26"), xmax = as.Date("2021-05-17"), ymin=-Inf, ymax=Inf), fill="#CC66FF", alpha=.01) + #Level 3
geom_rect(aes(xmin = as.Date("2021-05-17"), xmax = as.Date("2021-06-05"), ymin=-Inf, ymax=Inf), fill="#9966FF", alpha=.01) + #Level 2
geom_rect(aes(xmin = as.Date("2021-06-05"), xmax = as.Date("2021-07-19"), ymin=-Inf, ymax=Inf), fill="#9999FF", alpha=.01) + #Most mainland level 1
geom_rect(aes(xmin = as.Date("2021-07-19"), xmax = as.Date("2021-08-09"), ymin=-Inf, ymax=Inf), fill="#66CCFF", alpha=.01) + #Level 0
geom_rect(aes(xmin = as.Date("2021-08-09"), xmax = as.Date("2022-12-31"), ymin=-Inf, ymax=Inf), fill="#00FFFF", alpha=.01) + #Beyond level 0
#theme_classic()+
labs(x= "Date",
y = "Total number of Scottish A&E attendances")
Covid_aeScotlandactivity_timeline2018to2022flip <- Covid_aeScotlandactivity_timeline2018to2022 + coord_flip()
save_plot("Output/Covid_aeScotlandactivity_timeline2018to2022flip.svg", fig=Covid_aeScotlandactivity_timeline2018to2022flip, width=14, height=12)
Covid_aeScotlandactivity_timeline2018to2022flip
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
#Including sin and cos month into the modelling
#Chris created a new proportion table with sin_month and cos_month as it was the heavy computations were beyond the capabilities of Hui's computer
#Loading A&E demographic csv file
Covid_AE_Prop_Time_Pivot_GLM <- read_csv(here("Rawdata", "AE_Prop_Time_Pivot_GLM_Data.csv"))
View(Covid_AE_Prop_Time_Pivot_GLM)
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtyNine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
View(Covid_AE_Prop_Time_Pivot_GLM)
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
View(Covid_AE_Prop_Time_Pivot_GLM)
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
View(Covid_AE_Prop_Time_Pivot_GLM)
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtyNine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
summary(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
#For the coefficients here, we can exponentiate them and this tells us the % increase in attendances for a 1% increase in this group
exp_coef_Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- exp(coef(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour))
exp_coef_Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour
#To calculate the AIC
glm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour_aic <- AIC(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
#renaming the headers
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
glm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour_aic
#McFadden's Rsquared
pR2(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)['McFadden']
#BIC
BIC(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
#log likelihood
logLik(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
Covidglm_Covidperiod <- glm(TotalAttendances ~ CovidPeriod,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
summary(Covidglm_Covidperiod)
Covidglm_Covidperiod <- glm(TotalAttendances ~ C(CovidPeriod),
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
summary(Covidglm_Covidperiod)
Covidglm_sex <- glm(TotalAttendances ~ Male + Female,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
summary(Covidglm_sex)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, Unknownsex)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
Neteffect_sex$coeffpropmale <- Neteffect_sex %>% Neteffect_sex$Male*-2.731
Neteffect_sex$coeffpropmale <- Neteffect_sex %>% mutate(Neteffect_sex$Male*-2.731)
View(Neteffect_sex)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
View(Neteffect_sex)
Neteffect_sex$coeffpropmale <- Neteffect_sex %>% Neteffect_sex$Male*"-2.731"
Neteffect_sex$coeffpropmale <-  Neteffect_sex$Male*"-2.731"
Maleprop <- -2.731
Neteffect_sex$coeffpropmale <-  Neteffect_sex$Male*Maleprop
View(Neteffect_sex)
Femaleprop <-  -3.578
Neteffect_sex$coeffpropfemale <-  Neteffect_sex$Male*Femaleprop
View(Neteffect_sex)
Neteffect_sex$Year <- substr(Neteffect_sex$Month, 1,4)
Neteffect_sex$monthnumeric <- substr(Neteffect_sex$Month, 5,6)
Neteffect_sex$day <- "01"
#converting from character to numeric variable
Neteffect_sex$Year <- as.numeric(Neteffect_sex$Year)
Neteffect_sex$monthnumeric <- as.numeric(Neteffect_sex$monthnumeric)
Neteffect_sex$day <- as.numeric(Neteffect_sex$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_sex<- Neteffect_sex %>%
mutate(date=make_date(Year, monthnumeric, day))
View(Neteffect_sex)
Neteffect_sex$coeffpropmaleplusfemale<- coeffpropmale+coeffpropfemale
Neteffect_sex$coeffpropmaleplusfemale<- Neteffect_sex$coeffpropmale + Neteffect_sex$coeffpropfemale
View(Neteffect_sex)
#exponentiating the sum of the coefficient times proportion for males and females
Neteffect_sex$expcoeffpropmaleplusfemale <- exp(Neteffect_sex$coeffpropmaleplusfemale)
ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
str(Neteffect_sex)
Neteffect_sex$expcoeffpropmaleplusfemale <- as.numeric(Neteffect_sex$expcoeffpropmaleplusfemale)
str(Neteffect_sex)
ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
ggplot(data=Neteffect_sex, aes(x=Month, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
ggplot(data=Neteffect_sex, aes(x=date, y=coeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
