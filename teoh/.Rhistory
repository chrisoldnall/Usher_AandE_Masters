Covid_monthlyae_glmwhen$monthnumeric <- substr(Covid_monthlyae_glmwhen$Month, 5,6)
Covid_monthlyae_glmwhen$day <- "01"
#converting from character to numeric variable
Covid_monthlyae_glmwhen$Year <- as.numeric(Covid_monthlyae_glmwhen$Year)
Covid_monthlyae_glmwhen$monthnumeric <- as.numeric(Covid_monthlyae_glmwhen$monthnumeric)
Covid_monthlyae_glmwhen$day <- as.numeric(Covid_monthlyae_glmwhen$day)
#making a date column using the Year, monthnumeric and day columns
Covid_monthlyae_glmwhen<- Covid_monthlyae_glmwhen%>%
mutate(date=make_date(Year, monthnumeric, day))
str(Covid_monthlyae_glmwhen)
#calculating total attendances
Covid_monthlyae_glmwhentotal <- Covid_monthlyae_glmwhen %>%
select(date, NumberOfAttendances) %>%
group_by(date) %>%
summarise(NumberOfAttendances=sum(NumberOfAttendances))
#calculating total attendances by day
Covid_monthlyae_glmwhenday <- Covid_monthlyae_glmwhen %>%
select(date, Day, NumberOfAttendances) %>%
group_by(date, Day) %>%
summarise(NumberOfAttendances=sum(NumberOfAttendances))
#merge day attendances with total attendances to calculate proportion
Covid_monthlyae_glmwhenday <- merge(Covid_monthlyae_glmwhenday, Covid_monthlyae_glmwhentotal, by=c("date"))
#changing column names so it is clear which is total and which is for day
colnames(Covid_monthlyae_glmwhenday)<- c("date", "Day","DayAttendances","TotalAttendances")
#to calculate the proportion for each day
Covid_monthlyae_glmwhenday$Proportions <-Covid_monthlyae_glmwhenday$DayAttendances/Covid_monthlyae_glmwhenday$TotalAttendances
Covid_monthlyae_glmwhenday <- Covid_monthlyae_glmwhenday %>% select(date,Day,Proportions)
#to change the data from a long to a wide format
Covid_monthlyae_glmwhenday <- pivot_wider(Covid_monthlyae_glmwhenday, names_from = Day, values_from = Proportions)
str(Covid_monthlyae_glmwhenday)
#calculating total attendances by hour
Covid_monthlyae_glmwhenhour <- Covid_monthlyae_glmwhen %>%
select(date, Hour, NumberOfAttendances) %>%
group_by(date, Hour) %>%
summarise(NumberOfAttendances=sum(NumberOfAttendances))
#merge hour attendances with total attendances to calculate proportion
Covid_monthlyae_glmwhenhour <- merge(Covid_monthlyae_glmwhenhour, Covid_monthlyae_glmwhentotal, by=c("date"))
#changing column names so it is clear which is total and which is for hour
colnames(Covid_monthlyae_glmwhenhour)<- c("date", "Hour","HourAttendances","TotalAttendances")
#to calculate the proportion for each hour
Covid_monthlyae_glmwhenhour$Proportions <-Covid_monthlyae_glmwhenhour$HourAttendances/Covid_monthlyae_glmwhenhour$TotalAttendances
Covid_monthlyae_glmwhenhour <- Covid_monthlyae_glmwhenhour %>% select(date,Hour,Proportions)
#to change the data from a long to a wide format
Covid_monthlyae_glmwhenhour <- pivot_wider(Covid_monthlyae_glmwhenhour, names_from = Hour, values_from = Proportions)
Covid_monthlyae_glmwhenhour <- Covid_monthlyae_glmwhenhour %>%
rename(c("Midnighttoone" = "00:00 to 00:59",
"Onetotwoam" = "01:00 to 01:59",
"Twotothreeam" = "02:00 to 02:59",
"Threetofouram" = "03:00 to 03:59",
"Fourtofiveam" = "04:00 to 04:59",
"Fivetosixam" = "05:00 to 05:59",
"Sixtosevenam" = "06:00 to 06:59",
"Seventoeightam" = "07:00 to 07:59",
"Eighttonineam" = "08:00 to 08:59",
"Ninetotenam" = "09:00 to 09:59",
"Tentoelevenam" = "10:00 to 10:59",
"Eleventonoon" = "11:00 to 11:59",
"Noontoonepm" = "12:00 to 12:59",
"Onetotwopm" = "13:00 to 13:59",
"Twotothreepm" = "14:00 to 14:59",
"Threetofourpm" = "15:00 to 15:59",
"Fourtofivepm" = "16:00 to 16:59",
"Fivetosixpm" = "17:00 to 17:59",
"Sixtosevenpm" = "18:00 to 18:59",
"Seventoeightpm" = "19:00 to 19:59",
"Eighttoninepm" = "20:00 to 20:59",
"Ninetotenpm" = "21:00 to 21:59",
"Tentoelevenpm" = "22:00 to 22:59",
"Eleventomidnight" = "23:00 to 23:59"))
str(Covid_monthlyae_glmwhenhour)
Covid_monthlyae_glmwhenmonth <- Covid_monthlyae_glmwhen %>%
select(date, monthnumeric, NumberOfAttendances) %>%
group_by(date) %>%
summarise(NumberOfAttendances=sum(NumberOfAttendances))
#adding a new column for monthnumeric
Covid_monthlyae_glmwhenmonth$monthnumeric <-as.numeric(format(Covid_monthlyae_glmwhenmonth$date, "%m"))
#To set up the proportions for each month as a separate column
Covid_monthlyae_glmwhenmonth <- Covid_monthlyae_glmwhenmonth %>%
mutate(Jan = ifelse(.$monthnumeric=='1', '1', '0'),
Feb = ifelse(.$monthnumeric=='2', '1', '0'),
March = ifelse(.$monthnumeric=='3', '1', '0'),
April = ifelse(.$monthnumeric=='4', '1', '0'),
May = ifelse(.$monthnumeric=='5', '1', '0'),
June = ifelse(.$monthnumeric=='6', '1', '0'),
July = ifelse(.$monthnumeric=='7', '1', '0'),
August = ifelse(.$monthnumeric=='8', '1', '0'),
Sept = ifelse(.$monthnumeric=='9', '1', '0'),
Oct = ifelse(.$monthnumeric=='10', '1', '0'),
Nov = ifelse(.$monthnumeric=='11', '1', '0'),
Dec = ifelse(.$monthnumeric=='12', '1', '0'))
str(Covid_monthlyae_glmwhenmonth)
Covid_monthlyae_glmwhenmonth <- Covid_monthlyae_glmwhenmonth %>%
select(date, Jan, Feb, March, April, May, June, July, August, Sept, Oct, Nov, Dec)
Covid_monthlyae_glmwhenmonth$Jan <- as.numeric(Covid_monthlyae_glmwhenmonth$Jan)
Covid_monthlyae_glmwhenmonth$Feb <- as.numeric(Covid_monthlyae_glmwhenmonth$Feb)
Covid_monthlyae_glmwhenmonth$March <- as.numeric(Covid_monthlyae_glmwhenmonth$March)
Covid_monthlyae_glmwhenmonth$April <- as.numeric(Covid_monthlyae_glmwhenmonth$April)
Covid_monthlyae_glmwhenmonth$May <- as.numeric(Covid_monthlyae_glmwhenmonth$May)
Covid_monthlyae_glmwhenmonth$June <- as.numeric(Covid_monthlyae_glmwhenmonth$June)
Covid_monthlyae_glmwhenmonth$July <- as.numeric(Covid_monthlyae_glmwhenmonth$July)
Covid_monthlyae_glmwhenmonth$August <- as.numeric(Covid_monthlyae_glmwhenmonth$August)
Covid_monthlyae_glmwhenmonth$Sept <- as.numeric(Covid_monthlyae_glmwhenmonth$Sept)
Covid_monthlyae_glmwhenmonth$Oct <- as.numeric(Covid_monthlyae_glmwhenmonth$Oct)
Covid_monthlyae_glmwhenmonth$Nov <- as.numeric(Covid_monthlyae_glmwhenmonth$Nov)
Covid_monthlyae_glmwhenmonth$Dec <- as.numeric(Covid_monthlyae_glmwhenmonth$Dec)
#Combining all the proportions data into one table using merge
#Covid_monthlyae_glmdemographicsage
#Covid_monthlyae_glmdemographicssex
#Covid_monthlyae_glmdemographicsdeprivation
#Covid_monthlyae_glmdemographicsdepttype
#Covid_monthlyae_glmdemographicsHB
#Covid_monthlyae_glmdemographicsCoviddate_all
#Covid_monthlyae_glmwhenday
#Covid_monthlyae_glmwhenhour
#Covid_monthlyae_glmwhenmonth
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmdemographicsCoviddate_all, Covid_monthlyae_glmdemographicsdepttype, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicssex, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsage, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsdeprivation, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenday, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenmonth, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmwhenhour, by=c("date"))
Covid_monthlyae_glmprop <- merge(Covid_monthlyae_glmprop, Covid_monthlyae_glmdemographicsHB, by=c("date"))
#To include Time into the data frame
#example given: df$Time <- as.numeric(df$Date - min(df$Date)) + 1
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
mutate(Time = as.numeric(Covid_monthlyae_glmprop$date - min(Covid_monthlyae_glmprop$date)) + 1)
#To limit the GLM proportion data to Jan 2018 to Dec 2022.
Covid_monthlyae_glmprop <- Covid_monthlyae_glmprop %>%
filter(between(date, as.Date("2018-01-01"), as.Date("2022-12-31")))
#To limit the glmdemographicstotal data to Jan 2018 to Dec 2022.
Covid_monthlyae_glmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
filter(between(date, as.Date("2018-01-01"), as.Date("2022-12-31")))
#To limit the glmwhentotal data to Jan 2018 to Dec 2022.
Covid_monthlyae_glmwhentotal <- Covid_monthlyae_glmwhentotal %>%
filter(between(date, as.Date("2018-01-01"), as.Date("2022-12-31")))
HistogramCovid_monthlyae_glmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(x=NumberOfAttendances))+
geom_histogram()
save_plot("Output/HistogramCovid_monthlyae_glmdemographicstotal.svg", fig = HistogramCovid_monthlyae_glmdemographicstotal, width = 14, height = 12)
QQplotglmdemographicstotal <- Covid_monthlyae_glmdemographicstotal %>%
ggplot(aes(sample=NumberOfAttendances)) +
stat_qq() +
stat_qq_line(color=2)
save_plot("Output/QQplotglmdemographicstotal.svg", fig = QQplotglmdemographicstotal, width = 14, height = 12)
Covid_monthlyae_glmdemographicstotal %>%
pull(NumberOfAttendances) %>%
ks.test(., "pnorm", mean=mean(.), sd=sd(.))
Covidglm_Coviddate <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddate)
Covidglm_Coviddatesex <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddatesex)
Covidglm_Coviddatesexage <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_Coviddatesexage)
Covidglm_CoviddatesexageSIMD <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMD)
Covidglm_CoviddatesexageSIMDday <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDday)
Covidglm_CoviddatesexageSIMDdaytype <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytype)
Covidglm_CoviddatesexageSIMDdaytypehour <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehour)
Covidglm_CoviddatesexageSIMDdaytypehourHB <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHB)
Covidglm_CoviddatesexageSIMDdaytypehourHBmonth <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Feb + March + April + May + June + July + August + Sept + Oct + Nov + Dec,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
Covidglm_CoviddatesexageSIMDdaytypehourHBTime <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + Midnighttoone + Twotothreeam + Threetofouram + Fourtofiveam + Fivetosixam + Sixtosevenam + Seventoeightam + Eighttonineam + Ninetotenam + Tentoelevenam + Eleventonoon + Noontoonepm + Onetotwopm + Twotothreepm + Threetofourpm + Fourtofivepm + Fivetosixpm + Sixtosevenpm + Seventoeightpm + Eighttoninepm + Ninetotenpm + Tentoelevenpm + Eleventomidnight + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
coefficients <- coef(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
exp_coefficients <- exp(coefficients)
exp_coefficients_df <- data.frame(Estimate = exp_coefficients)
print(exp_coefficients_df)
Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour <- glm(NumberOfAttendances ~ Coviddate2 + Coviddate3 + Coviddate4 + Male + Female + Under18 + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time,
family = poisson(link = "log"),
data = Covid_monthlyae_glmprop)
summary(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
coefficients <- coef(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
exp_coefficients <- exp(coefficients)
exp_coefficients_df <- data.frame(Estimate = exp_coefficients)
print(exp_coefficients_df)
coefficients
coefficients_df <- data.frame(Estimate = coefficients)
print(coefficients_df)
conf_intervals <- confint(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
exp_conf_intervals <- exp(conf_intervals)
exp_conf_intervals
glm_Coviddate_aic <- AIC(Covidglm_Coviddate)
glm_Coviddatesex_aic <- AIC(Covidglm_Coviddatesex)
glm_Coviddatesexage_aic <- AIC(Covidglm_Coviddatesexage)
glm_CoviddatesexageSIMD_aic <- AIC(Covidglm_CoviddatesexageSIMD)
glm_CoviddatesexageSIMDday_aic <- AIC(Covidglm_CoviddatesexageSIMDday)
glm_CoviddatesexageSIMDdaytype_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytype)
glm_CoviddatesexageSIMDdaytypehour_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehour)
glm_CoviddatesexageSIMDdaytypehourHB_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHB)
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth)
glm_CoviddatesexageSIMDdaytypehourHBTime_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
glm_CoviddatesexageSIMDdaytypeHBTimenohour_aic <- AIC(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
glm_CoviddatesexageSIMDdaytypeHBTimenohour_aic
glm_CoviddatesexageSIMDdaytypehourHBTime_aic
glm_CoviddatesexageSIMDdaytypehourHBmonth_aic
glm_CoviddatesexageSIMDdaytypehourHB_aic
glm_CoviddatesexageSIMDdaytypehour_aic
glm_CoviddatesexageSIMDdaytype_aic
glm_CoviddatesexageSIMDday_aic
glm_CoviddatesexageSIMD_aic
glm_Coviddatesexage_aic
glm_Coviddatesex_aic
glm_Coviddate_aic
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)['McFadden']
library(pscl)
pR2(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)['McFadden']
pR2(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)['McFadden']
glm_Coviddate_predictions <-predict(Covidglm_Coviddate, type = "response")
summary(glm_Coviddate_predictions)
glm_Coviddatesex_predictions <-predict(Covidglm_Coviddatesex, type = "response")
summary(glm_Coviddatesex_predictions)
glm_Coviddatesexage_predictions <-predict(Covidglm_Coviddatesexage, type = "response")
summary(glm_Coviddatesexage_predictions)
glm_CoviddatesexageSIMD_predictions <-predict(Covidglm_CoviddatesexageSIMD, type = "response")
summary(glm_CoviddatesexageSIMD_predictions)
glm_CoviddatesexageSIMDday_predictions <-predict(Covidglm_CoviddatesexageSIMDday, type = "response")
summary(glm_CoviddatesexageSIMDday_predictions)
glm_CoviddatesexageSIMDdaytype_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytype, type = "response")
summary(glm_CoviddatesexageSIMDdaytype_predictions)
glm_CoviddatesexageSIMDdaytypehour_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytypehour, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehour_predictions)
glm_CoviddatesexageSIMDdaytypehourHB_predictions <-predict(Covidglm_CoviddatesexageSIMDdaytypehourHB, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHB_predictions)
glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions <- predict(Covidglm_CoviddatesexageSIMDdaytypehourHBmonth, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions)
glm_CoviddatesexageSIMDdaytypehourHBTime_predictions <- predict(Covidglm_CoviddatesexageSIMDdaytypehourHBTime, type = "response")
summary(glm_CoviddatesexageSIMDdaytypehourHBTime_predictions)
glm_CoviddatesexageSIMDdaytypeHBTimenohour_predictions <- predict(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour, type = "response")
summary(glm_CoviddatesexageSIMDdaytypeHBTimenohour_predictions)
#Loading population estimate (only till 2022) csv file
Scotpopulation2018to2022Covidglmplot <- read_csv(here("Rawdata", "20240809Popestimate_HB2019_1981to2022.csv"))
#Filtering out total Scottish estimates (HB S92000003) for each year, leaving just individual HBs in the list
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(!HB%in%"S92000003")
#Excluding population by sex, only the totals for each HB each year
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
filter(Sex=="All")
#Only getting the total population estimates for 2018-2022
Scotpopulation2018to2022Covidglmplot <- Scotpopulation2018to2022Covidglmplot %>%
group_by(Year) %>%
summarise(AllAges=sum(AllAges)) %>%
filter(Year=="2018"|Year=="2019"|Year=="2020"|Year=="2021"|Year=="2022") %>%
select(Year, AllAges)
#Selecting only the columns needed for glm plot and adding a column for year to join with the population data
Covid_monthlyae_glmpropglmplot <- Covid_monthlyae_glmprop %>%
select(date, NumberOfAttendances)
str(Covid_monthlyae_glmpropglmplot )
#this didn't work because date was already in date format
#Covid_monthlyae_glmpropglmplot$Year <- format(Covid_monthlyae_glmprop$date, format="%Y/%m/%d","%Y")
#used this instead
Covid_monthlyae_glmpropglmplot$Year <- as.numeric(format(Covid_monthlyae_glmprop$date,'%Y'))
#combining population data with attendance data to create the glm plot
Covid_monthlyae_glmpropglmplot <-
merge(Scotpopulation2018to2022Covidglmplot, Covid_monthlyae_glmpropglmplot, by=c("Year"))
Covid_monthlyae_glmpropglmplot <- Covid_monthlyae_glmpropglmplot %>%
mutate("glmCoviddateprediction" = glm_Coviddate_predictions/AllAges,
"glmCoviddatesexprediction" = glm_Coviddatesex_predictions/AllAges,
"glmCoviddatesexageprediction" = glm_Coviddatesexage_predictions/AllAges,
"glmCoviddatesexageSIMDprediction" = glm_CoviddatesexageSIMD_predictions/AllAges,
"glmCoviddatesexageSIMDdayprediction" = glm_CoviddatesexageSIMDday_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypeprediction" = glm_CoviddatesexageSIMDdaytype_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourprediction" = glm_CoviddatesexageSIMDdaytypehour_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBprediction" = glm_CoviddatesexageSIMDdaytypehourHB_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBmonthprediction" = glm_CoviddatesexageSIMDdaytypehourHBmonth_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypehourHBTimeprediction" = glm_CoviddatesexageSIMDdaytypehourHBTime_predictions/AllAges,
"glmCoviddatesexageSIMDdaytypeHBTimenohourprediction" = glm_CoviddatesexageSIMDdaytypeHBTimenohour_predictions/AllAges,
"rates" = NumberOfAttendances/AllAges)
glmCoviddateprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddateprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddateprediction), color = "yellow4")
save_plot("Output/glmCoviddateprediction.svg", fig = glmCoviddateprediction, width = 5, height = 5)
glmCoviddatesexprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddateprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexprediction), color = "red")
save_plot("Output/glmCoviddatesexprediction.svg", fig = glmCoviddatesexprediction, width = 5, height = 5)
glmCoviddatesexageprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageprediction), color = "blue")
save_plot("Output/glmCoviddatesexageprediction.svg", fig = glmCoviddatesexageprediction, width = 5, height = 5)
glmCoviddatesexageSIMDprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDprediction), color = "green")
save_plot("Output/glmCoviddatesexageSIMDprediction.svg", fig = glmCoviddatesexageSIMDprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdayprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdayprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdayprediction), color = "yellow")
save_plot("Output/glmCoviddatesexageSIMDdayprediction.svg", fig = glmCoviddatesexageSIMDdayprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypeprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypeprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypeprediction), color = "orange")
save_plot("Output/glmCoviddatesexageSIMDdaytypeprediction.svg", fig = glmCoviddatesexageSIMDdaytypeprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourprediction), color = "purple")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBprediction), color = "brown")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBmonthprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBmonthprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBmonthprediction), color = "salmon")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBmonthprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBmonthprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypehourHBTimeprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypehourHBTimeprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypehourHBTimeprediction), color = "magenta")
save_plot("Output/glmCoviddatesexageSIMDdaytypehourHBTimeprediction.svg", fig = glmCoviddatesexageSIMDdaytypehourHBTimeprediction, width = 5, height = 5)
glmCoviddatesexageSIMDdaytypeHBTimenohourprediction <- ggplot(data=Covid_monthlyae_glmpropglmplot, aes(x=date))+
labs(x="Time", y= "Attendance rate",
#title = "glmCoviddatesexageSIMDdaytypeHBTimenohourprediction"
)+
geom_line(aes(y= rates), color = "black")+
geom_line(aes(y=glmCoviddatesexageSIMDdaytypeHBTimenohourprediction), color = "orange")
save_plot("Output/glmCoviddatesexageSIMDdaytypeHBTimenohourprediction.svg", fig = glmCoviddatesexageSIMDdaytypeHBTimenohourprediction, width = 5, height = 5)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
#Loading A&E monthly attendance and waiting times csv file
Covid_monthlyae_activitydescrip <- read_csv(here("Rawdata", "monthlyae_activity_202406.csv"))
Covid_monthlyae_activitydescrip$Year <- substr(Covid_monthlyae_activitydescrip$Month, 1,4)
Covid_monthlyae_activitydescrip$monthnumeric <- substr(Covid_monthlyae_activitydescrip$Month, 5,6)
Covid_monthlyae_activitydescrip$day <- "01"
Covid_monthlyae_activitydescrip$Year <- as.numeric(Covid_monthlyae_activitydescrip$Year)
Covid_monthlyae_activitydescrip$monthnumeric <- as.numeric(Covid_monthlyae_activitydescrip$monthnumeric)
Covid_monthlyae_activitydescrip$day <- as.numeric(Covid_monthlyae_activitydescrip$day)
Covid_monthlyae_activitydescrip<- Covid_monthlyae_activitydescrip %>%
mutate(date=make_date(Year, monthnumeric, day))
#Restrict data to years till Dec 2022 (period between 2007-07-01 to 2022-12-31)
Covid_monthlyae_activitydescrip <- Covid_monthlyae_activitydescrip %>%filter(between(date, as.Date('2018-01-01'), as.Date('2022-12-31')))
#Checking if there are null values, result returned 129648
sum(is.na(Covid_monthlyae_activitydescrip))
#Checking if there are null values for NumberOfAttendancesAll, result returned zero
sum(is.na(Covid_monthlyae_activitydescrip$NumberOfAttendancesAll))
#Checking if there are null values for NumberWithin4HoursAll, result returned zero
sum(is.na(Covid_monthlyae_activitydescrip$NumberWithin4HoursAll))
#Checking if there are null values for PercentageWithin4HoursAll, result returned zero
sum(is.na(Covid_monthlyae_activitydescrip$PercentageWithin4HoursAll))
unique(Covid_monthlyae_activitydescrip$HBT)
#Summary for the the years split by ED and MIU/Other
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Emergency Department')%>%summary()
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Minor Injury Unit or Other')%>%summary()
summary(Covid_monthlyae_activitydescrip)
#Count number of ED and MIU/Other sites
Covid_monthlyae_activitydescrip %>% filter(DepartmentType=="Emergency Department") %>% count(TreatmentLocation)
Covid_monthlyae_activitydescrip %>% filter(DepartmentType=="Minor Injury Unit or Other") %>% count(TreatmentLocation)
#Entry with the lowest and highest NumberOfAttendancesAll
Covid_monthlyae_activitydescrip[which.min(Covid_monthlyae_activitydescrip$NumberOfAttendancesAll),]
Covid_monthlyae_activitydescrip[which.max(Covid_monthlyae_activitydescrip$NumberOfAttendancesAll),]
#Entry with the lowest and highest PercentageWithin4HoursAll
Covid_monthlyae_activitydescrip[which.min(Covid_monthlyae_activitydescrip$PercentageWithin4HoursAll),]
View(Covid_monthlyae_activitydescrip)
#Entry with the lowest and highest PercentageWithin4HoursAll
Covid_monthlyae_activitydescrip[which.min(Covid_monthlyae_activitydescrip$PercentageWithin4HoursAll),]
Covid_monthlyae_activitydescrip[which.max(Covid_monthlyae_activitydescrip$PercentageWithin4HoursAll),]
Covid_monthlyae_activitydescrip %>%
summarise(mean=mean(NumberOfAttendancesAll),
median = median(NumberOfAttendancesAll),
sd=sd(NumberOfAttendancesAll),
min=min(NumberOfAttendancesAll),
max=max(NumberOfAttendancesAll),
var=var(NumberOfAttendancesAll))
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Emergency Department')%>%
summarise(mean=mean(NumberOfAttendancesAll),
median = median(NumberOfAttendancesAll),
sd=sd(NumberOfAttendancesAll),
min=min(NumberOfAttendancesAll),
max=max(NumberOfAttendancesAll),
var=var(NumberOfAttendancesAll))
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Minor Injury Unit or Other')%>%
summarise(mean=mean(NumberOfAttendancesAll),
median = median(NumberOfAttendancesAll),
sd=sd(NumberOfAttendancesAll),
min=min(NumberOfAttendancesAll),
max=max(NumberOfAttendancesAll),
var=var(NumberOfAttendancesAll))
Covid_monthlyae_activitydescriptotal <- Covid_monthlyae_activitydescrip %>%
select(date, Year, HBT, NumberOfAttendancesAll, NumberWithin4HoursAll) %>%
group_by(date) %>%
summarise(NumberOfAttendancesAll=sum(NumberOfAttendancesAll),
NumberWithin4HoursAll=sum(NumberWithin4HoursAll))
HistogramCovid_monthlyae_activitydescriptotal <- Covid_monthlyae_activitydescriptotal %>%
ggplot(aes(x=NumberOfAttendancesAll))+
geom_histogram()
save_plot("Output/HistogramCovid_monthlyae_activitydescriptotal.svg", fig = HistogramCovid_monthlyae_activitydescriptotal, width = 14, height = 12)
QQplotCovid_monthlyae_activitydescriptotal <- Covid_monthlyae_activitydescriptotal %>%
ggplot(aes(sample=NumberOfAttendancesAll)) +
stat_qq() +
stat_qq_line(color=2)
save_plot("Output/QQplotCovid_monthlyae_activitydescriptotal.svg", fig = QQplotCovid_monthlyae_activitydescriptotal, width = 14, height = 12)
Covid_monthlyae_activitydescriptotal %>%
pull(NumberOfAttendancesAll) %>%
ks.test(., "pnorm", mean=mean(.), sd=sd(.))
summary(Covid_monthlyae_activitydescrip)
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Minor Injury Unit or Other')%>%summary()
summary(Covid_monthlyae_activitydescrip)
#Summary for the the years split by ED and MIU/Other
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Emergency Department')%>%summary()
Covid_monthlyae_activitydescrip %>%filter(DepartmentType == 'Minor Injury Unit or Other')%>%summary()
exp_conf_intervals
summary(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
coefficients <- coef(Covidglm_CoviddatesexageSIMDdaytypehourHBTime)
exp_coefficients <- exp(coefficients)
exp_coefficients_df <- data.frame(Estimate = exp_coefficients)
print(exp_coefficients_df)
coefficients <- coef(Covidglm_CoviddatesexageSIMDdaytypeHBTimenohour)
coefficients_df <- data.frame(Estimate = coefficients)
print(coefficients_df)
#to exponentiate model using time, no hours
exp_coefficients <- exp(coefficients)
exp_coefficients_df <- data.frame(Estimate = exp_coefficients)
print(exp_coefficients_df)
exp_coefficients
View(Covid_monthlyae_glmwhentotal)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
#Loading A&E monthly attendance and waiting times csv file
Covid_monthlyae_activitydescrip <- read_csv(here("Rawdata", "monthlyae_activity_202406.csv"))
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Covid_monthlyae_activitydescrip$Year <- substr(Covid_monthlyae_activitydescrip$Month, 1,4)
Covid_monthlyae_activitydescrip$monthnumeric <- substr(Covid_monthlyae_activitydescrip$Month, 5,6)
Covid_monthlyae_activitydescrip$day <- "01"
#converting from character to numeric variable
Covid_monthlyae_activitydescrip$Year <- as.numeric(Covid_monthlyae_activitydescrip$Year)
Covid_monthlyae_activitydescrip$monthnumeric <- as.numeric(Covid_monthlyae_activitydescrip$monthnumeric)
Covid_monthlyae_activitydescrip$day <- as.numeric(Covid_monthlyae_activitydescrip$day)
#making a date column using the Year, monthnumeric and day columns
Covid_monthlyae_activitydescrip<- Covid_monthlyae_activitydescrip %>%
mutate(date=make_date(Year, monthnumeric, day))
#Restrict data to years till Dec 2022 (period between 2018-01-01 to 2022-12-31)
Covid_monthlyae_activitydescrip <- Covid_monthlyae_activitydescrip %>%filter(between(date, as.Date('2018-01-01'), as.Date('2022-12-31')))
#2007-07-01 to 2022-12-31: Checking if there are null values, result returned 129648
#Jan 2018 up to Dec 2022: Checking if there are null values, result returned 35648
sum(is.na(Covid_monthlyae_activitydescrip))
#Checking if there are null values for NumberOfAttendancesAll, result returned zero for 2007-07-01 to 2022-12-31 and Jan 2018 up to Dec 2022
sum(is.na(Covid_monthlyae_activitydescrip$NumberOfAttendancesAll))
#Checking if there are null values for NumberWithin4HoursAll, result returned zero for 2007-07-01 to 2022-12-31 and Jan 2018 up to Dec 2022
sum(is.na(Covid_monthlyae_activitydescrip$NumberWithin4HoursAll))
#Checking if there are null values for PercentageWithin4HoursAll, result returned zero for 2007-07-01 to 2022-12-31 and Jan 2018 up to Dec 2022
sum(is.na(Covid_monthlyae_activitydescrip$PercentageWithin4HoursAll))
str(Covid_monthlyae_activitydescrip)
#Eyeballing the dataset
view(Covid_monthlyae_activitydescrip)
View(Covid_monthlyae_glmprop)
