Neteffect_sex$expcoeffpropmaleplusfemale <- as.numeric(Neteffect_sex$expcoeffpropmaleplusfemale)
str(Neteffect_sex)
ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
ggplot(data=Neteffect_sex, aes(x=Month, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
ggplot(data=Neteffect_sex, aes(x=date, y=coeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
str(Neteffect_sex)
#drawing the graph of Net effect of sex on total attendances over time
#code returned error message Error in aes(x = Month, y = expcoeffpropmaleplusfemale) + geom_line() +  :
#non-numeric argument to binary operator
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
#drawing the graph of Net effect of sex on total attendances over time
#code returned error message Error in aes(x = Month, y = expcoeffpropmaleplusfemale) + geom_line() +  :
#non-numeric argument to binary operator
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=Month, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
View(Neteffect_sex)
Neteffect_sex$expcoeffpropmaleplusfemale <- as.numeric(Neteffect_sex$expcoeffpropmaleplusfemale)
Neteffect_sex$date <- as.Date(Neteffect_sex$date)
#drawing the graph of Net effect of sex on total attendances over time
#code returned error message Error in aes(x = Month, y = expcoeffpropmaleplusfemale) + geom_line() +  :
#non-numeric argument to binary operator
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale)+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances"))
#drawing the graph of Net effect of sex on total attendances over time
#code returned error message Error in aes(x = Month, y = expcoeffpropmaleplusfemale) + geom_line() +  :
#non-numeric argument to binary operator
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale))+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances")
Neteffect_sex_plot
save_plot("Output/Neteffect_sex_plot.svg", fig=Neteffect_sex_plot, width=14, height=12)
View(Neteffect_sex)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
#Calculating the coefficient times proportion for males and females
Maleprop <- -2.731
Neteffect_sex$coeffpropmale <-  Neteffect_sex$Male*Maleprop
Femaleprop <-  -3.578
Neteffect_sex$coeffpropfemale <-  Neteffect_sex$Female*Femaleprop
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_sex$Year <- substr(Neteffect_sex$Month, 1,4)
Neteffect_sex$monthnumeric <- substr(Neteffect_sex$Month, 5,6)
Neteffect_sex$day <- "01"
#converting from character to numeric variable
Neteffect_sex$Year <- as.numeric(Neteffect_sex$Year)
Neteffect_sex$monthnumeric <- as.numeric(Neteffect_sex$monthnumeric)
Neteffect_sex$day <- as.numeric(Neteffect_sex$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_sex<- Neteffect_sex %>%
mutate(date=make_date(Year, monthnumeric, day))
#sum of the coefficient times proportion for males and females
Neteffect_sex$coeffpropmaleplusfemale<- Neteffect_sex$coeffpropmale + Neteffect_sex$coeffpropfemale
Neteffect_sex$expcoeffpropmaleplusfemale <- exp(Neteffect_sex$coeffpropmaleplusfemale)
str(Neteffect_sex)
Neteffect_sex$expcoeffpropmaleplusfemale <- as.numeric(Neteffect_sex$expcoeffpropmaleplusfemale)
Neteffect_sex$date <- as.Date(Neteffect_sex$date)
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemale))+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances")
save_plot("Output/Neteffect_sex_plot.svg", fig=Neteffect_sex_plot, width=14, height=12)
Neteffect_sex_plot
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
#Including sin and cos month into the modelling
#Chris created a new proportion table with sin_month and cos_month as it was the heavy computations were beyond the capabilities of Hui's computer
#Loading A&E demographic csv file
Covid_AE_Prop_Time_Pivot_GLM <- read_csv(here("Rawdata", "AE_Prop_Time_Pivot_GLM_Data.csv"))
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
str(Covid_AE_Prop_Time_Pivot_GLM)
#Make CovidPeriod a categorical factor
Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod <- as.factor(Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod)
str(Covid_AE_Prop_Time_Pivot_GLM)
View(Covid_AE_Prop_Time_Pivot_GLM)
View(Covid_AE_Prop_Time_Pivot_GLM)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
#Used this model in the final version
#Including sin and cos month into the modelling
#Chris created a new proportion table with sin_month and cos_month as it was the heavy computations were beyond the capabilities of Hui's computer
#Loading A&E demographic csv file
Covid_AE_Prop_Time_Pivot_GLM <- read_csv(here("Rawdata", "AE_Prop_Time_Pivot_GLM_Data.csv"))
#Used this model in the final version
#Including sin and cos month into the modelling
#Chris created a new proportion table with sin_month and cos_month as it was the heavy computations were beyond the capabilities of Hui's computer
#Loading A&E demographic csv file
Covid_AE_Prop_Time_Pivot_GLM <- read_csv(here("Rawdata", "AE_Prop_Time_Pivot_GLM_Data.csv"))
View(Covid_AE_Prop_Time_Pivot_GLM)
#renaming the headers
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
View(Covid_AE_Prop_Time_Pivot_GLM)
#Make CovidPeriod a categorical factor
Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod <- as.factor(Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod)
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + UnknownSex + UnknownAge + Seventyfiveplus + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtyNine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + UnknownSIMD + Monday + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + MIU + NHSAyshireandArran + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + UnknownSex + UnknownAge + Seventyfiveplus + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + UnknownSIMD + Monday + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + MIU + NHSAyshireandArran + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + UnknownSex + UnknownAge + Seventyfiveplus + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + UnknownSIMD + Monday + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + MIU + NHSAyrshireandArran + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
summary(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
#For the coefficients here, we can exponentiate them and this tells us the % increase in attendances for a 1% increase in this group
exp_coef_Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- exp(coef(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour))
exp_coef_Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour
#To calculate the AIC
glm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour_aic <- AIC(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
glm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour_aic
#McFadden's Rsquared
pR2(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)['McFadden']
#BIC
BIC(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
#log likelihood
logLik(Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
View(Neteffect_sex)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_sex$Year <- substr(Neteffect_sex$Month, 1,4)
Neteffect_sex$monthnumeric <- substr(Neteffect_sex$Month, 5,6)
Neteffect_sex$day <- "01"
#converting from character to numeric variable
Neteffect_sex$Year <- as.numeric(Neteffect_sex$Year)
Neteffect_sex$monthnumeric <- as.numeric(Neteffect_sex$monthnumeric)
Neteffect_sex$day <- as.numeric(Neteffect_sex$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_sex<- Neteffect_sex %>%
mutate(date=make_date(Year, monthnumeric, day))
View(Neteffect_sex)
#calculate the difference in proportions each month
Neteffect_sex$Malediff <- diff(Neteffect_sex$Malediff)
#calculate the difference in proportions each month
Neteffect_sex$Malediff <- diff(Neteffect_sex$Male)
#calculate the difference in proportions each month
Neteffect_sex$Malediff <- Neteffect_sex$Male - 0.4896559
View(Neteffect_sex)
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_sex$Year <- substr(Neteffect_sex$Month, 1,4)
Neteffect_sex$monthnumeric <- substr(Neteffect_sex$Month, 5,6)
Neteffect_sex$day <- "01"
#converting from character to numeric variable
Neteffect_sex$Year <- as.numeric(Neteffect_sex$Year)
Neteffect_sex$monthnumeric <- as.numeric(Neteffect_sex$monthnumeric)
Neteffect_sex$day <- as.numeric(Neteffect_sex$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_sex<- Neteffect_sex %>%
mutate(date=make_date(Year, monthnumeric, day))
View(Neteffect_sex)
View(Neteffect_sex)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
#Used this model in the final version (no reference/base category)
#Including sin and cos month into the modelling
#Chris created a new proportion table with sin_month and cos_month as it was the heavy computations were beyond the capabilities of Hui's computer
#Loading A&E demographic csv file
Covid_AE_Prop_Time_Pivot_GLM <- read_csv(here("Rawdata", "AE_Prop_Time_Pivot_GLM_Data.csv"))
#renaming the headers
Covid_AE_Prop_Time_Pivot_GLM <- Covid_AE_Prop_Time_Pivot_GLM %>%
rename(c("Undereighteen" = "Under 18",
"EighteentoTwentyfour" = "18-24",
"TwentyfivetoThirtynine" = "25-39",
"FortytoSixtyfour" = "40-64",
"SixtyfivetoSeventyfour" = "65-74",
"Seventyfiveplus" = "75 plus",
"NHSAyrshireandArran" = "S08000015",
"NHSBorders" = "S08000016",
"NHSDumfriesandGalloway" = "S08000017",
"NHSForthValley" = "S08000019",
"NHSGrampian" = "S08000020",
"NHSHighland" = "S08000022",
"NHSLothian" = "S08000024",
"NHSOrkney" = "S08000025",
"NHSShetland" = "S08000026",
"NHSWesternIsles" = "S08000028",
"NHSFife" = "S08000029",
"NHSTayside" = "S08000030",
"NHSGreaterGlasgowandClyde" = "S08000031",
"NHSLanarkshire" = "S08000032"))
#Make CovidPeriod a categorical factor
Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod <- as.factor(Covid_AE_Prop_Time_Pivot_GLM$CovidPeriod)
##Using sin and cos of month
Covidglm_CovidperiodsexageSIMDdaytypeHBTimesincosnohour <- glm(TotalAttendances ~ CovidPeriod + Male + Female + UnknownSex + UnknownAge + Seventyfiveplus + Undereighteen + EighteentoTwentyfour + TwentyfivetoThirtynine + FortytoSixtyfour + SixtyfivetoSeventyfour + SIMD1 + SIMD2 + SIMD3 + SIMD4 + SIMD5 + UnknownSIMD + Monday + Tuesday + Wednesday + Thursday + Friday + Saturday + Sunday + ED + MIU + NHSAyrshireandArran + NHSBorders + NHSFife + NHSShetland + NHSLanarkshire + NHSDumfriesandGalloway+ NHSForthValley + NHSGrampian + NHSWesternIsles + NHSOrkney + NHSTayside + NHSGreaterGlasgowandClyde + NHSHighland + NHSLothian + Time + sin_month + cos_month,
family = poisson(link = "log"),
data = Covid_AE_Prop_Time_Pivot_GLM)
#Net effect of sex on attendances
Neteffect_sex <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, Male, Female, UnknownSex)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_sex$Year <- substr(Neteffect_sex$Month, 1,4)
Neteffect_sex$monthnumeric <- substr(Neteffect_sex$Month, 5,6)
Neteffect_sex$day <- "01"
#converting from character to numeric variable
Neteffect_sex$Year <- as.numeric(Neteffect_sex$Year)
Neteffect_sex$monthnumeric <- as.numeric(Neteffect_sex$monthnumeric)
Neteffect_sex$day <- as.numeric(Neteffect_sex$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_sex<- Neteffect_sex %>%
mutate(date=make_date(Year, monthnumeric, day))
Neteffect_sexdiff <- Neteffect_sex %>%
select(Male, Female, UnknownSex)
View(Neteffect_sexdiff)
Neteffect_sexdiff <- sapply(Neteffect_sexdiff, diff)
View(Neteffect_sexdiff)
firstdiffline <- c(0, 0, 0)
Neteffect_sexdiff <- rbind(firstdiffline, Neteffect_sexdiff)
View(Neteffect_sexdiff)
Neteffect_sexdiff <- Neteffect_sexdiff %>%
rename("Malediff"="Male",
"Femalediff"="Female",
"UnknownSexdiff"="UnknownSex")
Neteffect_sexdiff <- Neteffect_sexdiff %>%
rename(c("Malediff"="Male",
"Femalediff"="Female",
"UnknownSexdiff"="UnknownSex"))
#changing column names so it is clear it is for diff
colnames(Neteffect_sexdiff)<- c("Malediff", "Femalediff","UnknownSexdiff")
View(Neteffect_sexdiff)
Neteffect_sex <- cbind(Neteffect_sex, Neteffect_sexdiff)
View(Neteffect_sex)
#Calculating the coefficient times proportion for males, females and unknownsex
Malecoeff <- -0.9047
Neteffect_sex$coeffpropmale <-  Neteffect_sex$Malediff*Malecoeff
Femalecoeff <-  -0.4119
Neteffect_sex$coeffpropfemale <-  Neteffect_sex$Femalediff*Femalecoeff
View(Neteffect_sex)
#sum of the coefficient times proportion for males and females
Neteffect_sex$coeffpropmaleplusfemaleplusunknown<- Neteffect_sex$coeffpropmale + Neteffect_sex$coeffpropfemale
#exponentiating the sum of the coefficient times proportion for males and females
Neteffect_sex$expcoeffpropmaleplusfemaleplusunknown <- exp(Neteffect_sex$coeffpropmaleplusfemaleplusunknown)
ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemaleplusunknown))+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances")
Neteffect_sex_plot <- ggplot(data=Neteffect_sex, aes(x=date, y=expcoeffpropmaleplusfemaleplusunknown))+
geom_line()+
labs(title="Net effect of sex on total attendances over time",
x = "Date",
y = "Net effect on attendances")
save_plot("Output/Neteffect_sex_plot.svg", fig=Neteffect_sex_plot, width=14, height=12)
View(Covid_AE_Prop_Time_Pivot_GLM)
##AGE
#Net effect of age on attendances
Neteffect_age <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
##AGE
#Net effect of age on attendances
Neteffect_age <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
library(tidyverse)
library(here)
library(readxl)
library(dplyr)
library(ggplot2)
library(lubridate)
library(sf)
library(scales)
library(sjPlot)
library(pscl)
library(flexmix)
##AGE
#Net effect of age on attendances
Neteffect_age <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
View(Neteffect_age)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_age$Year <- substr(Neteffect_age$Month, 1,4)
Neteffect_age$monthnumeric <- substr(Neteffect_age$Month, 5,6)
Neteffect_age$day <- "01"
#converting from character to numeric variable
Neteffect_age$Year <- as.numeric(Neteffect_age$Year)
Neteffect_age$monthnumeric <- as.numeric(Neteffect_age$monthnumeric)
Neteffect_age$day <- as.numeric(Neteffect_age$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_age<- Neteffect_age %>%
mutate(date=make_date(Year, monthnumeric, day))
View(Neteffect_age)
#creating a dataframe to calculate the difference in proportions
Neteffect_agediff <- Neteffect_age %>%
select(EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
#to calculate the difference in proportions
Neteffect_agediff <- sapply(Neteffect_agediff, diff)
#to add a row for the first line of zero
firstdiffline_age <- c(0, 0, 0, 0, 0, 0, 0)
#to combine the line of zero with the proportion differences
Neteffect_agediff <- rbind(firstdiffline_age, Neteffect_agediff)
#changing column names so it is clear it is for diff
colnames(Neteffect_agediff)<- c(EighteentoTwentyfourdiff, TwentyfivetoThirtyninediff, FortytoSixtyfourdiff, SixtyfivetoSeventyfourdiff, Seventyfiveplusdiff, Undereighteendiff, UnknownAgediff)
#Combine original Neteffect_sex dataframe to contain the proportion differences
Neteffect_age <- cbind(Neteffect_age, Neteffect_agediff)
View(Neteffect_age)
##AGE
#Net effect of age on attendances
Neteffect_age <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_age$Year <- substr(Neteffect_age$Month, 1,4)
Neteffect_age$monthnumeric <- substr(Neteffect_age$Month, 5,6)
Neteffect_age$day <- "01"
#converting from character to numeric variable
Neteffect_age$Year <- as.numeric(Neteffect_age$Year)
Neteffect_age$monthnumeric <- as.numeric(Neteffect_age$monthnumeric)
Neteffect_age$day <- as.numeric(Neteffect_age$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_age<- Neteffect_age %>%
mutate(date=make_date(Year, monthnumeric, day))
View(Neteffect_sexdiff)
View(Neteffect_agediff)
#changing column names so it is clear it is for diff
colnames(Neteffect_agediff)<- c(EighteentoTwentyfourdiff, TwentyfivetoThirtyninediff, FortytoSixtyfourdiff, SixtyfivetoSeventyfourdiff, Seventyfiveplusdiff, Undereighteendiff, UnknownAgediff)
View(Neteffect_agediff)
#creating a dataframe to calculate the difference in proportions
Neteffect_agediff <- Neteffect_age %>%
select(EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
#to calculate the difference in proportions
Neteffect_agediff <- sapply(Neteffect_agediff, diff)
#to add a row for the first line of zero
firstdiffline_age <- c(0, 0, 0, 0, 0, 0, 0)
#to combine the line of zero with the proportion differences
Neteffect_agediff <- rbind(firstdiffline_age, Neteffect_agediff)
View(Neteffect_agediff)
#changing column names so it is clear it is for diff
colnames(Neteffect_agediff)<- c(EighteentoTwentyfourdiff, TwentyfivetoThirtyninediff, FortytoSixtyfourdiff, SixtyfivetoSeventyfourdiff, Seventyfiveplusdiff, Undereighteendiff, UnknownAgediff)
View(Neteffect_agediff)
View(Neteffect_agediff)
##AGE
#Net effect of age on attendances
Neteffect_age <- Covid_AE_Prop_Time_Pivot_GLM %>%
select(Month, EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
#To create a date column
#creating a new column for Year, monthnumeric and day using data from the Month column
Neteffect_age$Year <- substr(Neteffect_age$Month, 1,4)
Neteffect_age$monthnumeric <- substr(Neteffect_age$Month, 5,6)
Neteffect_age$day <- "01"
#converting from character to numeric variable
Neteffect_age$Year <- as.numeric(Neteffect_age$Year)
Neteffect_age$monthnumeric <- as.numeric(Neteffect_age$monthnumeric)
Neteffect_age$day <- as.numeric(Neteffect_age$day)
#making a date column using the Year, monthnumeric and day columns
Neteffect_age<- Neteffect_age %>%
mutate(date=make_date(Year, monthnumeric, day))
#creating a dataframe to calculate the difference in proportions
Neteffect_agediff <- Neteffect_age %>%
select(EighteentoTwentyfour, TwentyfivetoThirtynine, FortytoSixtyfour, SixtyfivetoSeventyfour, Seventyfiveplus, Undereighteen, UnknownAge)
View(Neteffect_agediff)
#to calculate the difference in proportions
Neteffect_agediff <- sapply(Neteffect_agediff, diff)
View(Neteffect_agediff)
#to add a row for the first line of zero
firstdiffline_age <- c(0, 0, 0, 0, 0, 0, 0)
#to combine the line of zero with the proportion differences
Neteffect_agediff <- rbind(firstdiffline_age, Neteffect_agediff)
View(Neteffect_agediff)
#changing column names so it is clear it is for diff
colnames(Neteffect_agediff)<- c("EighteentoTwentyfourdiff", "TwentyfivetoThirtyninediff", "FortytoSixtyfourdiff", "SixtyfivetoSeventyfourdiff", "Seventyfiveplusdiff", "Undereighteendiff", "UnknownAgediff")
View(Neteffect_agediff)
#Combine original Neteffect_sex dataframe to contain the proportion differences
Neteffect_age <- cbind(Neteffect_age, Neteffect_agediff)
View(Neteffect_age)
#Calculate diff for male and female. Then times the coefficient. Then add it and then overall exponentiation.
#Calculating the coefficient times proportion for males, females and unknownsex
Undereighteencoeff <- 2.594
Neteffect_age$coeffpropUndereighteen <- Neteffect_age$Undereighteendiff*Undereighteencoeff
EighteentoTwentyfourcoeff <- 2.478
Neteffect_age$coeffpropEighteentoTwentyfour <-Neteffect_age$EighteentoTwentyfourdiff*EighteentoTwentyfourcoeff
TwentyfivetoThirtyninecoeff <- -3.873
Neteffect_age$coeffpropTwentyfivetoThirtynine <- Neteffect_age$TwentyfivetoThirtyninediff*TwentyfivetoThirtyninecoeff
FortytoSixtyfourcoeff <- 2.599
Neteffect_age$coeffpropFortytoSixtyfour <- Neteffect_age$FortytoSixtyfourdiff*FortytoSixtyfourcoeff
Seventyfivepluscoeff <- 4.365
Neteffect_age$coeffpropSeventyfiveplus <- Neteffect_age$Seventyfiveplusdiff*Seventyfivepluscoeff
#sum of the coefficient times proportion for all ages
Neteffect_age$coeffpropallages<- Neteffect_age$coeffpropUndereighteen + Neteffect_age$coeffpropEighteentoTwentyfour + Neteffect_age$coeffpropTwentyfivetoThirtynine + Neteffect_age$coeffpropFortytoSixtyfour +
#Neteffect_age$coeffpropSixtyfivetoSeventyfour +
Neteffect_age$coeffpropSeventyfiveplus
#exponentiating the sum of the coefficient times proportion for all ages
Neteffect_age$expcoeffpropallages <- exp(Neteffect_age$coeffpropallages)
ggplot(data=Neteffect_age, aes(x=date, y=expcoeffpropallages))+
geom_line()+
labs(title="Net effect of age on total attendances over time",
x = "Date",
y = "Net effect on attendances")
Neteffect_age_plot <- ggplot(data=Neteffect_age, aes(x=date, y=expcoeffpropallages))+
geom_line()+
labs(title="Net effect of age on total attendances over time",
x = "Date",
y = "Net effect on attendances")
save_plot("Output/Neteffect_age_plot.svg", fig=Neteffect_age_plot, width=14, height=12)
